{% extends "annasebba/base.html" %}

{% block title %}{{ course.title }}{% endblock %}

{% block content %}
<div class="bg-[#F3F6FB] py-16">
  <div class="max-w-5xl mx-auto px-4">
    
    {# --- Link de Voltar --- #}
    <a href="{% url 'course_list' %}" class="text-sm font-semibold text-[#E87A4F] hover:underline">
      &larr; Voltar para a lista de cursos
    </a>

    <article class="mt-6 bg-white rounded-3xl shadow-lg p-6 md:p-10">
      
      {# --- Cabeçalho do Card --- #}
      <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
        <div>
          <span class="text-sm font-bold text-[#E87A4F] uppercase tracking-wide">
            Curso / Treinamento
          </span>
          <h1 class="mt-2 text-3xl md:text-4xl font-serif font-bold text-[#1B3556]">
            {{ course.title }}
          </h1>
        </div>

        {# Preço destacado no topo (para quem ainda não comprou) #}
        {% if not is_enrolled %}
          <div class="bg-[#F3F6FB] px-6 py-3 rounded-xl text-center md:text-right shrink-0">
             <span class="block text-sm text-[#7A8CA5] font-semibold uppercase">Investimento</span>
             <span class="text-2xl font-bold text-[#1B3556]">
                {% if course.price > 0 %}
                    R$ {{ course.price }}
                {% else %}
                    Gratuito
                {% endif %}
             </span>
          </div>
        {% endif %}
      </div>

      {# --- Imagem de Capa --- #}
      {% if course.cover_image %}
        <div class="mt-8 mb-8">
          <img src="{{ course.cover_image.url }}" alt="{{ course.title }}"
               class="w-full max-h-[450px] object-cover rounded-2xl shadow-sm">
        </div>
      {% endif %}

      {# --- LOGICA DE ACESSO VS VENDA --- #}
      
      {% if is_enrolled %}
        
        {# --- VISÃO DO ALUNO (Conteúdo Completo) --- #}
        <div class="bg-green-50 border border-green-200 rounded-2xl p-6 mb-8 flex items-center gap-4">
            <div class="bg-green-100 p-2 rounded-full text-green-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </div>
            <div>
                <h3 class="font-bold text-green-800 text-lg">Acesso Liberado</h3>
                <p class="text-green-700 text-sm">Você é aluno deste curso. Bons estudos!</p>
            </div>
        </div>

        <div class="mt-6 prose prose-lg max-w-none text-[#3E5A7B] prose-headings:font-serif prose-headings:text-[#1B3556] prose-a:text-[#E87A4F]">
          <h3 class="text-2xl font-bold font-serif text-[#1B3556] mb-4">Conteúdo do Curso</h3>
          {# Aqui entra o conteúdo rico/HTML do curso #}
          {{ course.description|safe }}
        </div>

      {% else %}

        {# --- VISÃO DE VISITANTE (Página de Vendas) --- #}
        
        <div class="mt-6 prose prose-lg max-w-none text-[#3E5A7B]">
            <p class="lead text-xl text-[#1B3556] font-medium">
                {{ course.summary }}
            </p>
            
            {# Se quiser mostrar parte da descrição publica, pode por aqui, ou deixar escondido #}
        </div>

        <div class="mt-10 bg-[#F3F6FB] rounded-2xl p-8 md:p-10 text-center border border-gray-100">
            <h3 class="text-2xl font-serif font-bold text-[#1B3556] mb-4">Garanta sua vaga agora</h3>
            
            <p class="text-[#7A8CA5] mb-8 max-w-lg mx-auto">
                Tenha acesso imediato a todo o material exclusivo e comece a transformar sua carreira hoje mesmo.
            </p>

            {% if user.is_authenticated %}
                <form action="{% url 'course_buy' pk=course.pk %}" method="get">
                    <button type="submit" class="inline-block w-full md:w-auto px-8 py-4 rounded-lg bg-[#E87A4F] text-white font-bold text-lg hover:bg-[#d66a3e] transition shadow-lg transform hover:-translate-y-1">
                        Comprar por R$ {{ course.price }}
                    </button>
                </form>
            {% else %}
                <div class="flex flex-col gap-4 justify-center items-center">
                    <a href="{% url 'login' %}?next={{ request.path }}" class="inline-block w-full md:w-auto px-8 py-4 rounded-lg bg-[#1B3556] text-white font-bold text-lg hover:bg-[#152740] transition shadow-lg">
                        Fazer Login para Comprar
                    </a>
                    <span class="text-sm text-[#7A8CA5]">Não tem conta? <a href="{% url 'signup' %}" class="text-[#E87A4F] font-bold hover:underline">Cadastre-se</a></span>
                </div>
            {% endif %}
        </div>

      {% endif %}

    </article>

    {# --- Rodapé com botão voltar --- #}
    <div class="mt-10 text-center">
      <a href="{% url 'course_list' %}"
         class="inline-block px-6 py-3 rounded-full bg-white border border-[#1B3556] text-[#1B3556] font-semibold hover:bg-gray-50 transition">
        Ver outros cursos
      </a>
    </div>

  </div>
</div>
{% endblock %}